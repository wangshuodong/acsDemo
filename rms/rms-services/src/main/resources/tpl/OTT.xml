<?xml version="1.0" encoding="UTF-8"?>
<busi:Template xmlns:busi="http://www.iot.cn/BusiTemplate"
			   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
			   xsi:schemaLocation="http://www.iot.cn/BusiTemplate BusiTemplate.xsd ">

	<!-- 业务操作流程  D.4. OTT业务下发流程-->
	<OperationFlow operationReturn="InternetGatewayDevice.X_CMCC_UserInfo.Result">
		<!-- 1.	按附录D.2创建1个INTERNET类型的WAN，作为上网WAN连接。 -->
		<FlowBean id="INTERNET_PPPoE_Routed">

			<!--查询节点值实例-->
			<FlowBeanSearch id="INTERNETWAN">
				<!--查询根节点-->
				<Command>InternetGatewayDevice.WANDevice.1.WANConnectionDevice.</Command>
				<FlowBeanMatch id ="X_CMCC_ServiceList">
					<!--匹配正则表达式-->
					<Pattern>InternetGatewayDevice.WANDevice.1.WANConnectionDevice.[0-9]+.WANPPPConnection.[0-9]+.X_CMCC_ServiceList</Pattern>
					<!--匹配的值-->
					<MatchValue>INTERNET</MatchValue>
					<leaf>X_CMCC_ServiceList</leaf>
				</FlowBeanMatch>
				<FlowBeanMatch id ="X_CMCC_VLANIDMark">
					<!--匹配正则表达式-->
					<Pattern>InternetGatewayDevice.WANDevice.1.WANConnectionDevice.[0-9]+.WANPPPConnection.[0-9]+.X_CMCC_VLANIDMark</Pattern>
					<!--匹配的值-->
					<MatchValue>41</MatchValue>
					<leaf>X_CMCC_VLANIDMark</leaf>
				</FlowBeanMatch>
				<!--节点截取的依据串-->
				<SplitPath>X_CMCC_ServiceList</SplitPath><!-- 需要截取的路径所在的MatchBean的id-->
				<SplitStr>X_CMCC_ServiceList</SplitStr>

			</FlowBeanSearch>

			<!--如果refSearch查询到节点了，则本FlowBeanAdd不执行-->
			<FlowBeanAdd id="INTERNET_WANConnectionDevice" refSearch="INTERNETWAN" searchFirst="0">
				<Command>InternetGatewayDevice.WANDevice.1.WANConnectionDevice.</Command>
			</FlowBeanAdd>

			<!--如果refSearch查询到节点了，则本FlowBeanAdd不执行-->
			<FlowBeanAdd id="INTERNET_WANPPPConnection" ref="INTERNET_WANConnectionDevice" refSearch="INTERNETWAN" >
				<Command>WANPPPConnection.</Command>
			</FlowBeanAdd>
			<!--isNeedExcute,根据某个FLOW的ID查询FLOW的执行结果，如果执行结果不为空，则不需要执行-->
			<FlowBeanSet ref="INTERNET_WANPPPConnection" refSearch="INTERNETWAN" isNeedExcute ="INTERNETWAN">
				<SetParam>
					<!--2表示重写VLAN-->
					<Command>X_CMCC_VLANMode</Command>
					<Default>2</Default>
				</SetParam>
				<SetParam>
					<!--某个省的VLANID应该是固定的，41是安徽的-->
					<Command>X_CMCC_VLANIDMark</Command>
					<Default>41</Default>
				</SetParam>
				<SetParam>
					<Command>ConnectionType</Command>
					<Default>PPPoE_Routed</Default>
				</SetParam>
				<SetParam>
					<Command>Username</Command>
					<ParamKey>Username</ParamKey>
				</SetParam>
				<SetParam>
					<Command>Password</Command>
					<ParamKey>Password</ParamKey>
				</SetParam>
				<!--<SetParam>
					<Command>X_CMCC_LanInterface</Command>
					<ParamKey>INTERNET_X_CMCC_LanInterface</ParamKey>
				</SetParam>-->
				<SetParam>
					<Command>X_CMCC_ServiceList</Command>
					<Default>INTERNET</Default>
				</SetParam>
				<SetParam>
					<Command>Enable</Command>
					<Default>1</Default>
				</SetParam>
			</FlowBeanSet>
		</FlowBean>

		<!-- 2.	按附录D.2/D.3创建1个OTHER类型的WAN，作为OTT业务的WAN连接。 -->
		<FlowBean id="OTHER_PPPoE_Routed">
			<!-- <FlowBeanAdd id="OTHER_WANDevice">
				<Command>InternetGatewayDevice.WANDevice.</Command>
			</FlowBeanAdd> -->
			<!--查询节点值实例-->
			<FlowBeanSearch id="OTHERWAN">
				<!--查询根节点-->
				<Command>InternetGatewayDevice.WANDevice.1.WANConnectionDevice.</Command>
				<FlowBeanMatch id ="X_CMCC_ServiceList">
					<!--匹配正则表达式-->
					<Pattern>InternetGatewayDevice.WANDevice.1.WANConnectionDevice.[0-9]+.WANPPPConnection.[0-9]+.X_CMCC_ServiceList</Pattern>
					<!--匹配的值-->
					<MatchValue>OTHER</MatchValue>
					<leaf>X_CMCC_ServiceList</leaf>
				</FlowBeanMatch>
				<FlowBeanMatch id ="X_CMCC_VLANIDMark">
					<!--匹配正则表达式-->
					<Pattern>InternetGatewayDevice.WANDevice.1.WANConnectionDevice.[0-9]+.WANPPPConnection.[0-9]+.X_CMCC_VLANIDMark</Pattern>
					<!--匹配的值-->
					<MatchValue>41</MatchValue>
					<leaf>X_CMCC_VLANIDMark</leaf>
				</FlowBeanMatch>
				<!--节点截取的依据串-->
				<SplitPath>X_CMCC_ServiceList</SplitPath><!-- 需要截取的路径所在的MatchBean的id-->
				<SplitStr>X_CMCC_ServiceList</SplitStr>
			</FlowBeanSearch>

			<FlowBeanAdd id="OTHER_WANConnectionDevice" searchFirst="0" refSearch="OTHERWAN">
				<Command>InternetGatewayDevice.WANDevice.1.WANConnectionDevice.</Command>
			</FlowBeanAdd>

			<!-- 2.添加实例 -->
			<FlowBeanAdd id="OTHER_WANPPPConnection" ref="OTHER_WANConnectionDevice" refSearch="OTHERWAN">
				<Command>WANPPPConnection.</Command>
			</FlowBeanAdd>

			<!-- 3.设置参数 -->
			<FlowBeanSet ref="OTHER_WANPPPConnection" refSearch="OTHERWAN">
				<SetParam>
					<!--2表示重写VLAN-->
					<Command>X_CMCC_VLANMode</Command>
					<Default>2</Default>
				</SetParam>
				<SetParam>
					<!--某个省的VLANID应该是固定的，41是安徽的-->
					<Command>X_CMCC_VLANIDMark</Command>
					<Default>41</Default>
				</SetParam>
				<SetParam>
					<Command>ConnectionType</Command>
					<Default>PPPoE_Routed</Default>
				</SetParam>
				<SetParam>
					<Command>Username</Command>
					<ParamKey>Username</ParamKey>
				</SetParam>
				<SetParam>
					<Command>Password</Command>
					<ParamKey>Password</ParamKey>
				</SetParam>
				<!--<SetParam>
					<Command>X_CMCC_LanInterface</Command>
					<ParamKey>OTHER_X_CMCC_LanInterface</ParamKey>
				</SetParam>-->
				<SetParam>
					<Command>X_CMCC_ServiceList</Command>
					<Default>OTHER</Default>
				</SetParam>
				<SetParam>
					<Command>Enable</Command>
					<Default>1</Default>
				</SetParam>
			</FlowBeanSet>
		</FlowBean>

		<!-- 3.	设置默认路由 InternetGatewayDevice.Layer3Forwarding.DefaultConnectionService =（INTERNET WAN路径） -->
		<FlowBean>
			<FlowBeanSet >
				<SetParam>
					<Command>InternetGatewayDevice.Layer3Forwarding.DefaultConnectionService</Command>
					<!--配置FlowBean的ID，表示取这个FlowBean的最终执行结果，最后一步执行结果不为空的结果值-->
					<ParamKey>INTERNET_PPPoE_Routed</ParamKey>
				</SetParam>
			</FlowBeanSet>
		</FlowBean>

		<!-- 4.	增加实例InternetGatewayDevice.Layer3Forwarding.Forwarding.{i}. 实例 -->
		<FlowBean >
			<FlowBeanAdd id="Forwarding">
				<Command>InternetGatewayDevice.Layer3Forwarding.Forwarding.</Command>
			</FlowBeanAdd>

			<!-- 3.设置参数 -->
			<FlowBeanSet ref="Forwarding">
				<SetParam>
					<!--OTT服务器IP-->
					<Command>DestIPAddress</Command>
					<Default>192.168.1.2</Default>
				</SetParam>
				<SetParam>
					<!--OTT服务器掩码-->
					<Command>DestSubnetMask</Command>
					<Default>255.255.0.0</Default>
				</SetParam>
				<SetParam>
					<Command>Interface</Command>
					<!--配置FlowBean的ID，表示取这个FlowBean的最终执行结果，最后一步执行结果不为空的结果值-->
					<ParamKey>OTHER_PPPoE_Routed</ParamKey>
				</SetParam>
			</FlowBeanSet>
		</FlowBean>
	</OperationFlow>
</busi:Template>