<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cmiot.rms.dao.mapper.BatchSetTaskMapper" >
    <resultMap id="BaseResultMap" type="com.cmiot.rms.dao.model.BatchSetTask" >
        <id column="id" property="id" jdbcType="VARCHAR" />
        <result column="area_code" property="areaCode" jdbcType="VARCHAR" />
        <result column="is_delete" property="isDelete" jdbcType="CHAR" />
        <result column="create_time" property="createTime" jdbcType="VARCHAR" />
        <result column="delete_time" property="deleteTime" jdbcType="VARCHAR" />
        <result column="task_state" property="taskState" jdbcType="CHAR" />
        <result column="area_name" property="areaName" jdbcType="VARCHAR" />
        <result column="trriger_event_1" property="trrigerEvent1" jdbcType="VARCHAR" />
        <result column="trriger_event_2" property="trrigerEvent2" jdbcType="VARCHAR" />
        <result column="trriger_event_3" property="trrigerEvent3" jdbcType="VARCHAR" />
        <result column="trriger_event_4" property="trrigerEvent4" jdbcType="VARCHAR" />

    </resultMap>
    <sql id="Base_Column_List" >
        id, area_code, is_delete, create_time, delete_time, task_state,trriger_event_1,trriger_event_2,trriger_event_3,trriger_event_4
    </sql>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
        select
         a.id, a.area_code, is_delete, create_time, delete_time, task_state,area_name,trriger_event_1,trriger_event_2,trriger_event_3,trriger_event_4
        from t_batch_set_task a
        where a.id = #{id,jdbcType=VARCHAR} AND a.is_delete = 1
    </select>


    <select id="selectByParm" parameterType="java.util.Map"
            resultMap="BaseResultMap">
        select
        a.id, a.area_code, is_delete, create_time, delete_time, area_name,task_state,trriger_event_1,trriger_event_2,trriger_event_3,trriger_event_4
        from t_batch_set_task a
        where a.is_delete = 1
        <if test="id != null">
            and a.id =
            #{id,jdbcType=VARCHAR}
        </if>
        <if test="parmName != null">
            AND a.id IN (SELECT batch_set_task_id FROM t_batch_set_task_detail b WHERE b.parm_name= #{parmName,jdbcType=VARCHAR})
        </if>
        <if test="areaCode != null">
            and a.area_code IN
            <foreach collection="areaCode" index="index" separator="," item="item" open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="trrigerEvent1 != null">
            and a.trriger_event_1 =
            #{trrigerEvent1,jdbcType=VARCHAR}
        </if>
        <if test="trrigerEvent2 != null">
            and a.trriger_event_2 =
            #{trrigerEvent2,jdbcType=VARCHAR}
        </if>
        <if test="trrigerEvent3 != null">
            and a.trriger_event_3 =
            #{trrigerEvent3,jdbcType=VARCHAR}
        </if>
        <if test="trrigerEvent4 != null">
            and a.trriger_event_4 =
            #{trrigerEvent4,jdbcType=VARCHAR}
        </if>
        <if test="start != null">
            ORDER BY create_time DESC
            limit #{start},#{end}
        </if>
    </select>

    <select id="selectCountByParm" parameterType="java.util.Map"
            resultType="java.lang.Integer">
        select
        count(a.id)
        from t_batch_set_task a
        where a.is_delete = 1
        <if test="id != null">
            and a.id =
            #{id,jdbcType=VARCHAR}
        </if>
        <if test="parmName != null">
            AND a.id IN (SELECT batch_set_task_id FROM t_batch_set_task_detail b WHERE b.parm_name= #{parmName,jdbcType=VARCHAR})
        </if>
        <if test="areaCode != null">
            and a.area_code IN
            <foreach collection="areaCode" index="index" separator="," item="item" open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="trrigerEvent1 != null">
            and a.trriger_event_1 =
            #{trrigerEvent1,jdbcType=VARCHAR}
        </if>
        <if test="trrigerEvent2 != null">
            and a.trriger_event_2 =
            #{trrigerEvent2,jdbcType=VARCHAR}
        </if>
        <if test="trrigerEvent3 != null">
            and a.trriger_event_3 =
            #{trrigerEvent3,jdbcType=VARCHAR}
        </if>
        <if test="trrigerEvent4 != null">
            and a.trriger_event_4 =
            #{trrigerEvent4,jdbcType=VARCHAR}
        </if>
    </select>

    <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
        UPDATE t_batch_set_task SET is_delete = 2,delete_time = NOW()
        where id = #{id,jdbcType=VARCHAR}
    </delete>

    <insert id="insert" parameterType="com.cmiot.rms.dao.model.BatchSetTask" >
        insert into t_batch_set_task (id, area_code, is_delete,area_name,
        create_time, delete_time, task_state,trriger_event_1,trriger_event_2,trriger_event_3,trriger_event_4)
        values (#{id,jdbcType=VARCHAR}, #{areaCode,jdbcType=CHAR}, #{isDelete,jdbcType=CHAR},
        #{areaName,jdbcType=VARCHAR},
        #{createTime,jdbcType=VARCHAR}, #{deleteTime,jdbcType=VARCHAR}, #{taskState,jdbcType=CHAR},
        #{trrigerEvent1,jdbcType=CHAR}, #{trrigerEvent2,jdbcType=CHAR}, #{trrigerEvent3,jdbcType=CHAR}, #{trrigerEvent4,jdbcType=CHAR})
    </insert>
    <update id="updateByPrimaryKey" parameterType="com.cmiot.rms.dao.model.BatchSetTask" >
        update t_batch_set_task
        <set >
            <if test="trrigerEvent1 != null">
                 trriger_event_1 = #{trrigerEvent1,jdbcType=VARCHAR},
            </if>
            <if test="trrigerEvent2 != null">
                trriger_event_2 =#{trrigerEvent2,jdbcType=VARCHAR},
            </if>
            <if test="trrigerEvent3 != null">
                trriger_event_3 =#{trrigerEvent3,jdbcType=VARCHAR},
            </if>
            <if test="trrigerEvent4 != null">
                trriger_event_4 =#{trrigerEvent4,jdbcType=VARCHAR},
            </if>
            <if test="taskState != null">
                task_state =#{taskState,jdbcType=VARCHAR},
            </if>
        </set>
        where id = #{id,jdbcType=VARCHAR}
    </update>
</mapper>