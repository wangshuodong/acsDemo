<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cmiot.rms.dao.mapper.GatewayBusinessBeanMapper">
	<resultMap id="BaseResultMap"
		type="com.cmiot.rms.dao.model.derivedclass.GatewayBusinessBean">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
	<id column="order_no" property="order_no" jdbcType="VARCHAR" />
	<result column="GATEWAY_UUID" jdbcType="VARCHAR" property="gatewayUuid" />
    <result column="GATEWAY_TYPE" jdbcType="CHAR" property="gatewayType" />
    <result column="GATEWAY_MODEL" jdbcType="CHAR" property="gatewayModel" />
    <result column="GATEWAY_NAME" jdbcType="CHAR" property="gatewayName" />
    <result column="GATEWAY_VERSION" jdbcType="VARCHAR" property="gatewayVersion" />
    <result column="GATEWAY_SERIALNUMBER" jdbcType="VARCHAR" property="gatewaySerialnumber" />
    <result column="GATEWAY_FACTORY" jdbcType="CHAR" property="gatewayFactory" />
    <result column="GATEWAY_FACTORY_CODE" jdbcType="CHAR" property="gatewayFactoryCode" />
    <result column="GATEWAY_MEMO" jdbcType="VARCHAR" property="gatewayMemo" />
    <result column="GATEWAY_HARDWARE_VERSION" jdbcType="VARCHAR" property="gatewayHardwareVersion" />
    <result column="GATEWAY_JOIN_TIME" jdbcType="INTEGER" property="gatewayJoinTime" />
    <result column="GATEWAY_LAST_CONN_TIME" jdbcType="INTEGER" property="gatewayLastConnTime" />
    <result column="GATEWAY_ADSL_ACCOUNT" jdbcType="VARCHAR" property="gatewayAdslAccount" />
    <result column="GATEWAY_STATUS" jdbcType="VARCHAR" property="gatewayStatus" />
    <result column="GATEWAY_ADDRESSINGTYPE" jdbcType="VARCHAR" property="gatewayAddressingtype" />
    <result column="GATEWAY_IPADDRESS" jdbcType="VARCHAR" property="gatewayIpaddress" />
    <result column="GATEWAY_SUBNETMASK" jdbcType="VARCHAR" property="gatewaySubnetmask" />
    <result column="GATEWAY_DEFAULTGATEWAY" jdbcType="VARCHAR" property="gatewayDefaultgateway" />
    <result column="GATEWAY_DNSSERVERS" jdbcType="VARCHAR" property="gatewayDnsservers" />
    <result column="GATEWAY_MACADDRESS" jdbcType="VARCHAR" property="gatewayMacaddress" />
    <result column="GATEWAY_DHCPOPTIONNUMBEROFENTRIES" jdbcType="INTEGER" property="gatewayDhcpoptionnumberofentries" />
    <result column="GATEWAY_URL" jdbcType="VARCHAR" property="gatewayUrl" />
    <result column="GATEWAY_CONNECTIONREQUESTURL" jdbcType="VARCHAR" property="gatewayConnectionrequesturl" />
    <result column="GATEWAY_AREA_ID" jdbcType="VARCHAR" property="gatewayAreaId" />
    <result column="GATEWAY_AREA_Name" jdbcType="VARCHAR" property="gatewayAreaName" />
    <result column="GATEWAY_DEVICE_UUID" jdbcType="VARCHAR" property="gatewayDeviceUuid" />
    <result column="DEVICE_MODEL" jdbcType="VARCHAR" property="deviceModel" /> 
    <result column="GATEWAY_FIRMWARE_UUID" jdbcType="VARCHAR" property="gatewayFirmwareUuid" />
    <result column="GATEWAY_EXTERNALIPADDRESS" jdbcType="VARCHAR" property="gatewayExternalIPaddress" />
    <result column="GATEWAY_USER_PHONE" jdbcType="VARCHAR" property="gatewayUserPhone" />
    <result column="GATEWAY_USER_NAME" jdbcType="VARCHAR" property="gatewayUserName" />
    <result column="GATEWAY_USER_ADDRESS" jdbcType="VARCHAR" property="gatewayUserAddress" />
    <result column="GATEWAY_PASSWORD" jdbcType="VARCHAR" property="gatewayPassword" />
    <result column="GATEWAY_DIGEST_ACCOUNT" jdbcType="VARCHAR" property="gatewayDigestAccount" />
    <result column="GATEWAY_DIGEST_PASSWORD" jdbcType="VARCHAR" property="gatewayDigestPassword" />
      <result column="GATEWAY_FAMILY_ACCOUNT" jdbcType="VARCHAR" property="gatewayFamilyAccount" />
      <result column="GATEWAY_FAMILY_PASSWORD" jdbcType="VARCHAR" property="gatewayFamilyPassword" />
      <result column="OSGI" jdbcType="VARCHAR" property="osgi" />
      <result column="JVM" jdbcType="VARCHAR" property="jvm" />
      <result column="hardwareAblitySupportWifi24ghz" jdbcType="VARCHAR" property="hardwareAblitySupportWifi24ghz" />
      <result column="hardwareAblitySupportWifi58ghz" jdbcType="VARCHAR" property="hardwareAblitySupportWifi58ghz" />
      <result column="gateway_connectionrequest_username" jdbcType="VARCHAR" property="gatewayConnectionrequestUsername" />
      <result column="gateway_connectionrequest_password" jdbcType="VARCHAR" property="gatewayConnectionrequestPassword" />
      <result column="backup_file_max_number" property="backupFileMaxNumber" jdbcType="INTEGER" />
      <result column="log_switch_status" property="logSwitchStatus" jdbcType="INTEGER" />
      <result column="flowrate" property="flowRate" jdbcType="VARCHAR" />
      <result column="business_status" property="businessStatus" jdbcType="VARCHAR" />
      	
		<result column="business_type" property="business_type" jdbcType="VARCHAR" />
		<result column="business_statu" property="business_statu" jdbcType="VARCHAR" />
		<result column="create_time" property="create_time" jdbcType="INTEGER" />
		<result column="business_code_boss" property="business_code_boss" jdbcType="VARCHAR" />
		<result column="areacode" property="areacode" jdbcType="VARCHAR" />
		<result column="adsl_account" property="adsl_account" jdbcType="VARCHAR" />
		<result column="bandwidth" property="bandwidth" jdbcType="INTEGER" />
		<result column="adsl_password" property="adsl_password" jdbcType="VARCHAR" />

		<result column="fail_count" property="failCount" jdbcType="INTEGER" />
		<result column="update_time" property="updateTime" jdbcType="INTEGER" />

	</resultMap>

	<select id="queryList4Page"
		parameterType="com.cmiot.rms.dao.model.derivedclass.GatewayBusinessBean"
		resultMap="BaseResultMap">
		select
		t.order_no,t.business_type,t.business_statu,t.adsl_account,t.fail_count,t.update_time,t.areacode,g.gateway_macaddress,g.gateway_serialnumber,g.gateway_model,g.gateway_adsl_account,g.business_status,g.gateway_status
		from t_gateway_business t left JOIN t_gateway_info g 
		on t.gateway_password = g.gateway_password where 1 =1
		<if test="gatewayMacaddress != null">
			and g.gateway_macaddress like CONCAT('%',#{gatewayMacaddress},'%' )
		</if> 
		<if test="gatewaySerialnumber != null">
			and g.gateway_serialnumber like CONCAT('%',#{gatewaySerialnumber},'%' )
		</if>
		<if test="adsl_account != null">
			and t.adsl_account like CONCAT('%',#{adsl_account},'%' )
		</if>
		<if test="order_no != null">
			and t.order_no like CONCAT('%',#{order_no},'%' )
		</if>
		<if test='business_statu != null and business_statu == "0"'>
			<![CDATA[
				 AND (
					t.business_statu NOT IN ('1','4') AND  (t.business_type IN ('1','6','9')  OR (t.business_type = '8' AND (t.fail_count IS NULL OR  t.fail_count < #{failCount} ) ) )
					)
			]]>
		</if>
		<if test='business_statu != null and business_statu == "1"'>
			<![CDATA[
				and (
					(t.business_statu in ('1','4'))
					or (t.business_type = '8' and (t.fail_count is not null and  t.fail_count >= #{failCount} ) )
					or (t.business_type not in ('1','6','8','9'))
				)
			]]>
		</if>
		<if test='areacode != null and areacode != "0"'>
            and (t.areacode in ${areacode})
        </if>
		order by t.create_time desc
		
	</select>
	
	<select id="queryBusinessDetail" parameterType="String" resultMap="BaseResultMap">
		select
		t.order_no,t.business_type,t.business_statu,t.fail_count,t.create_time,t.gateway_password,t.business_code_boss,t.areacode,t.adsl_password,t.adsl_account,t.bandwidth,
		g.gateway_macaddress,g.gateway_serialnumber,g.gateway_model,g.gateway_area_id,g.gateway_adsl_account,g.business_status,g.gateway_status,m.manufacturer_name gateway_factory,
		g.gateway_version,g.gateway_hardware_version,g.gateway_ipaddress,g.gateway_join_time,g.gateway_last_conn_time
		from t_gateway_business t left JOIN t_gateway_info g 
		on t.gateway_password = g.gateway_password
		LEFT JOIN t_manufacturer_info m ON g.new_factory_code = m.id
		where t.order_no =#{order_no,jdbcType=VARCHAR}
	</select>
</mapper>